/*!
 * cropme v1.1.0
 * https://shpontex.github.io/cropme
 *
 * Copyright 2019 shpontex
 * Released under the MIT license
 *
 * Date: 2019-01-04T10:33:26.521Z
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Cropme=t()}(this,function(){"use strict";function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e){return e&&"object"===f(e)&&!Array.isArray(e)}function h(e){for(var t=arguments.length,i=new Array(1<t?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];if(!i.length)return e;var o,s=i.shift();if(a(e)&&a(s))for(var p in s)a(s[p])?(e[p]||Object.assign(e,n({},p,{})),h(e[p],s[p])):(o=s[p])&&Array.isArray(o)?(e[p]||Object.assign(e,n({},p,[])),e[p]=e[p].concat(s[p])):Object.assign(e,n({},p,s[p]));return h.apply(void 0,[e].concat(i))}function y(){return"translate("+this.properties.x+"px,"+this.properties.y+"px) scale("+this.properties.scale+") rotate("+this.properties.deg+"deg)"}function c(){if(this.properties.rotation_slider)this.options.rotation.slider?this.properties.rotation_slider.disabled=!this.options.rotation.enable:(this.properties.wrapper.removeChild(this.properties.rotation_slider.parentNode),delete this.properties.rotation_slider);else if(this.options.rotation.slider){var e=document.createElement("div");e.classList.add("cropme-rotation-slider");var t=this.properties.rotation_slider=document.createElement("input");t.type="range",t.setAttribute("min",-180),t.setAttribute("max",180),t.setAttribute("step",1),t.value=0,t.style.width=this.options.container.width+"px",e.appendChild(t),this.properties.wrapper.appendChild(e);var i=this;this.properties.rotation_slider.addEventListener("input",function(e){i.rotate(e.target.value)}),this.properties.rotation_slider.disabled=!this.options.rotation.enable}}function d(){function e(){var e=this.options.container.width/2+12;"left"===this.options.rotation.position&&(e=-this.options.container.width/2-20);var t=this.options.container.height/2+12;this.properties.sliderContainer.style.transform="translate("+e+"px, "+t+"px) rotate(-90deg)",this.properties.sliderContainer.style.marginTop="-24px",this.properties.slider.disabled=!this.options.zoom.enable}if(this.properties.slider)this.options.zoom.slider?e.call(this):(this.properties.wrapper.removeChild(this.properties.slider.parentNode),delete this.properties.slider);else if(this.options.zoom.slider){var t=this,i=this.properties.sliderContainer=document.createElement("div");i.classList.add("cropme-slider");var r=this.properties.slider=document.createElement("input");r.type="range",r.setAttribute("min",this.options.zoom.min),r.setAttribute("max",this.options.zoom.max),r.setAttribute("step",1e-6),r.style.width=this.options.container.width+"px",i.appendChild(r),this.properties.wrapper.insertBefore(i,this.properties.wrapper.firstChild),this.properties.slider.value=this.properties.scale,this.properties.slider.addEventListener("input",function(e){t.properties.scale=parseFloat(e.target.value),t.properties.image.style.transform=y.call(t)}),e.call(this)}}function u(){var e=this.properties.container;e||(e=this.properties.container=document.createElement("div"),this.properties.wrapper.appendChild(e)),e.classList.add("cropme-container"),e.style.width=this.options.container.width+"px",e.style.height=this.options.container.height+"px"}function m(){var e=this.properties.viewport=this.properties.viewport||document.createElement("div"),t=this.options;if(t.viewport.width=t.viewport.width>t.container.width?t.container.width:t.viewport.width,t.viewport.height=t.viewport.height>t.container.height?t.container.height:t.viewport.height,e.style.width=t.viewport.width+"px",e.style.height=t.viewport.height+"px",e.className="viewport","circle"===t.viewport.type&&(e.className="viewport circle"),t.viewport.border.enable){var i=(t.container.width-t.viewport.width)/2;t.viewport.border.width=i<t.viewport.border.width?i:t.viewport.border.width}else t.viewport.border.width=0;this.properties.viewport.style.borderWidth=t.viewport.border.width+"px",this.properties.viewport.style.borderColor=t.viewport.border.color,this.properties.container.appendChild(e)}function s(){u.call(this),c.call(this),d.call(this),function(){this.properties.image||(this.properties.image=new Image),this.properties.image.ondragstart=function(){return!1},this.properties.container.appendChild(this.properties.image)}.call(this),m.call(this);var a,h,r=0,o=0,l=this,e=function(e){e.preventDefault();var t=e.pageX,i=e.pageY;e.touches&&(t=e.touches[0].pageX,i=e.touches[0].pageY),r=l.properties.x||r,o=l.properties.y||o,a=t-r,h=i-o,document.addEventListener("mousemove",s),document.addEventListener("touchmove",s),document.addEventListener("mouseup",p),document.addEventListener("touchend",p)};l.properties.image.addEventListener("mousedown",e),l.properties.image.addEventListener("touchstart",e);var s=function(e){e.preventDefault();var t=e.pageX,i=e.pageY;if(e.touches&&(t=e.touches[0].pageX,i=e.touches[0].pageY),e.touches&&1<e.touches.length){var r=e.touches[1],o=t-r.pageX,s=i-r.pageY;if(l.options.rotation.enable){var p=90-180*Math.atan2(o,s)/Math.PI;l.properties.odeg||(l.properties.odeg=p-l.properties.deg),l.properties.deg=p-l.properties.odeg}if(l.options.zoom.enable){var n=Math.sqrt(Math.pow(o,2)+Math.pow(s,2));l.properties.od||(l.properties.od=n/l.properties.scale),l.properties.scale=l.properties.slider.value=n/l.properties.od}}else l.properties.x=t-a,l.properties.y=i-h;l.properties.image.style.transform=y.call(l)},p=function e(){document.removeEventListener("touchmove",s),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",e),document.removeEventListener("touchend",e),l.properties.od=0,l.properties.odeg=0;l.properties.scale;var t=l.properties.image.getBoundingClientRect(),i=l.properties.viewport.getBoundingClientRect(),r=(i.top,t.top,i.height,i.left,t.left,i.width,l.properties.image.style.transformOrigin.split("px "));parseInt(r[0]),parseInt(r[1]),parseInt(l.properties.deg),Math.PI};l.properties.container.addEventListener("mousewheel",function(e){e.preventDefault();var t=l.properties.scale+e.wheelDelta/1200*l.properties.scale;t>l.options.zoom.min&&t<l.options.zoom.max&&l.options.zoom.mouseWheel&&l.options.zoom.enable&&(l.options.zoom.slider&&(l.properties.slider.value=t),l.properties.scale=t,l.properties.image.style.transform=y.call(l))})}window.jQuery&&(jQuery.fn.cropme=function(t,e){if("object"===f(t))return this.each(function(){var e=new r(this,t);$(this).data("cropme",e)});if("string"!=typeof t)throw"Error: the argument must be an object or a string";var i=this.data("cropme");switch(t){case"position":return i.position();case"bind":return i.bind(e);case"crop":return i.crop(e);case"rotate":return i.rotate(e);case"reload":return i.reload(e);case"destroy":return i.destroy();default:throw"Error: "+t+" method not found"}});var r=function(){function i(e,t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),-1<e.className.indexOf("cropme-wrapper"))throw"Error: Cropme is already initialized";this.properties={},this.options=h(p,t),"img"===(this.properties.wrapper=e).tagName.toLowerCase()&&(this.properties.image=new Image,this.properties.image.src=e.src,this.properties.wrapper=document.createElement("div"),e.parentNode.insertBefore(this.properties.wrapper,e.previousSibling),e.parentNode.removeChild(e)),this.properties.wrapper.className+=" cropme-wrapper "+this.options.customClass,s.call(this),this.properties.image.src&&this.bind({url:this.properties.image.src})}var e,t,r;return e=i,(t=[{key:"bind",value:function(n){var e=this;this.properties.image.src=n.url;var a=this.properties,h=this.options,l=this;return new Promise(function(p){e.properties.image.onload=function(){var e=a.image.getBoundingClientRect(),t=a.container.getBoundingClientRect(),i=(t.width-e.width)/2,r=(t.height-e.height)/2,o=t.height/e.height,s=0;if(a.ox=i,a.oy=r,"object"===f(n.position)&&(i+=n.position.x||0,r+=n.position.y||0,o=n.position.scale||o,s=n.position.angle||s),h.zoom.max<=h.zoom.min)throw"Error: max zoom cannot be less or equal to min zoom";o<h.zoom.min&&(o=h.zoom.min),o>h.zoom.max&&(o=h.zoom.max),a.x=i,a.y=r,a.origin_x=e.width/2,a.origin_y=e.height/2,a.scale=o,l.options.zoom.slider&&(a.slider.value=o),a.deg=s,a.image.style.transform=y.call(l),a.image.style.transformOrigin=function(e,t){return e+"px "+t+"px"}.call(l,a.origin_x,a.origin_y),a.image.style.opacity=1,p(l.properties.image)}})}},{key:"rotate",value:function(e){this.properties.deg=e;var t=this.properties.image.style.transformOrigin.split("px "),i=parseInt(t[0]),r=parseInt(t[1]);this.properties.rotate_originx=i,this.properties.rotate_originy=r,this.properties.image.style.transform=y.call(this)}},{key:"crop",value:function(e){var i=function(e){var t=document.createElement("canvas"),i=t.getContext("2d"),r=this.options.viewport.width,o=this.options.viewport.height;"object"===f(e)&&(e.scale?(r*=e.scale,o*=e.scale):e.width&&(o=e.width*o/r,r=e.width)),t.width=r,t.height=o;var s=r/this.options.viewport.width,p=o/this.options.viewport.height,n=this.properties.deg,a=this.properties.x,h=this.properties.y;function l(e,t,i){this.properties.deg=e,this.properties.x=t,this.properties.y=i,this.properties.image.style.transform=y.call(this)}0!==n&&l.call(this,0,this.properties.ox,this.properties.oy);var c=this.properties.image.getBoundingClientRect(),d=this.properties.viewport.getBoundingClientRect(),u=s*(c.x-d.x-this.options.viewport.border.width),m=p*(c.y-d.y-this.options.viewport.border.width);if(0!==n&&(i.translate((a-this.properties.x)*s,(h-this.properties.y)*p),i.translate(r/2,o/2),i.rotate(n*Math.PI/180),i.translate(-r/2,-o/2)),i.drawImage(this.properties.image,u,m,c.width*s,c.height*p),"circle"===this.options.viewport.type){i.translate(r/2,o/2),i.rotate(-n*Math.PI/180),i.translate(-r/2,-o/2),i.scale(1,this.options.viewport.height/this.options.viewport.width);var g=(this.options.viewport.width-this.options.viewport.height)/2*s,v=(this.properties.x-a)*s,w=(this.properties.y-h)*p;0<g?w=g+2*w:g<0&&(w=g+w/2),i.translate(v,w),i.globalCompositeOperation="destination-in",i.arc(r/2,o/2,r/2,0,2*Math.PI),i.fill()}return"triangle"===this.options.viewport.type&&(i.translate(r/2,o/2),i.rotate(-n*Math.PI/180),i.translate(-r/2,-o/2),i.translate((this.properties.x-a)*s,(this.properties.y-h)*p),i.beginPath(),i.globalCompositeOperation="destination-in",i.moveTo(r/2,0),i.lineTo(r,o),i.lineTo(0,o),i.closePath(),i.fill()),l.call(this,n,a,h),t}.call(this,e);return e="object"===f(e)?e.type:e,new Promise(function(t){"blob"===e?i.toBlob(function(e){return t(URL.createObjectURL(e))}):t(i.toDataURL())})}},{key:"position",value:function(){return{x:this.properties.x-this.properties.ox,y:this.properties.y-this.properties.oy,scale:this.properties.scale.toFixed(6),angle:parseInt(this.properties.deg)}}},{key:"reload",value:function(e){this.options=h(p,e),d.call(this),u.call(this),c.call(this),m.call(this)}},{key:"destroy",value:function(){this.properties.wrapper.innerHTML="",this.properties.wrapper.className=this.properties.wrapper.className.replace("cropme-wrapper",""),delete this.options,delete this.properties}}])&&o(e.prototype,t),r&&o(e,r),i}(),p={container:{width:300,height:300},viewport:{width:100,height:100,border:{enable:!0,width:2,color:"#fff"}},zoom:{min:.01,max:3,enable:!0,mouseWheel:!0,slider:!1},customClass:"",rotation:{slider:!1,enable:!0,position:"right"}};return r});