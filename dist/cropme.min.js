/*!
 * cropme v1.3.1
 * https://shpontex.github.io/cropme
 *
 * Copyright 2019 shpontex
 * Released under the MIT license
 *
 * Date: 2019-07-31T06:21:36.034Z
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Cropme=e()}(this,function(){"use strict";function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function a(t){return t&&"object"===w(t)&&!Array.isArray(t)}function h(t){for(var e=arguments.length,i=new Array(1<e?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];if(!i.length)return t;var o,s=i.shift();if(a(t)&&a(s))for(var p in s)a(s[p])?(t[p]||Object.assign(t,n({},p,{})),h(t[p],s[p])):(o=s[p])&&Array.isArray(o)?(t[p]||Object.assign(t,n({},p,[])),t[p]=t[p].concat(s[p])):Object.assign(t,n({},p,s[p]));return h.apply(void 0,[t].concat(i))}function y(){return"translate("+this.properties.x+"px,"+this.properties.y+"px) scale("+this.properties.scale+") rotate("+this.properties.deg+"deg)"}function f(t,e){return t+"px "+e+"px"}function c(){if(this.properties.rotation_slider)this.options.rotation.slider?this.properties.rotation_slider.disabled=!this.options.rotation.enable:(this.properties.wrapper.removeChild(this.properties.rotation_slider.parentNode),delete this.properties.rotation_slider),this.properties.rotation_slider.style.width=this.properties.container.offsetWidth+"px";else if(this.options.rotation.slider){var t=document.createElement("div");t.classList.add("cropme-rotation-slider");var e=this.properties.rotation_slider=document.createElement("input");e.type="range",e.setAttribute("min",-180),e.setAttribute("max",180),e.setAttribute("step",1),e.value=0,e.style.width=this.properties.container.offsetWidth+"px",t.appendChild(e),this.properties.wrapper.appendChild(t);var i=this;this.properties.rotation_slider.addEventListener("input",function(t){i.rotate(t.target.value)}),this.properties.rotation_slider.disabled=!this.options.rotation.enable}}function d(){function t(){var t=(this.properties.wrapper.offsetWidth-this.properties.container.offsetWidth)/2,e=this.properties.container.offsetWidth/2+12+t;"left"===this.options.rotation.position&&(e=-this.properties.container.offsetWidth/2-20+t);var i=(this.properties.container.offsetWidth-this.properties.container.offsetHeight)/2,r=this.properties.container.offsetHeight/2+12-i;this.properties.sliderContainer.style.transform="translate("+e+"px, "+r+"px) rotate(-90deg)";var o=this.properties.container.offsetWidth/2;this.properties.sliderContainer.style.transformOrigin=o+"px 12px",this.properties.sliderContainer.style.marginTop="-24px",this.properties.slider.disabled=!this.options.zoom.enable}if(this.properties.slider)this.options.zoom.slider?t.call(this):(this.properties.wrapper.removeChild(this.properties.slider.parentNode),delete this.properties.slider);else if(this.options.zoom.slider){var e=this,i=this.properties.sliderContainer=document.createElement("div");i.classList.add("cropme-slider");var r=this.properties.slider=document.createElement("input");r.type="range",r.setAttribute("min",this.options.zoom.min),r.setAttribute("max",this.options.zoom.max),r.setAttribute("step",1e-6),r.style.width=this.properties.container.offsetHeight+"px",i.style.width=this.properties.container.offsetHeight+"px",i.appendChild(r),this.properties.wrapper.insertBefore(i,this.properties.wrapper.firstChild),this.properties.slider.value=this.properties.scale,this.properties.slider.addEventListener("input",function(t){e.properties.scale=parseFloat(t.target.value),e.properties.image.style.transform=y.call(e)}),t.call(this)}}function m(){var t=this.properties.container;t||(t=this.properties.container=document.createElement("div"),this.properties.wrapper.appendChild(t)),t.classList.add("cropme-container"),t.style.width=this.options.container.width+("string"==typeof this.options.container.width?"":"px"),t.style.height=this.options.container.height+"px"}function u(){var t=this.properties.viewport=this.properties.viewport||document.createElement("div"),e=this.properties.container,i=this.options,r=i.viewport.border.width;if(e.style.width=i.viewport.width>e.offsetWidth?i.viewport.width+2*r+"px":e.offsetWidth,e.style.height=i.viewport.height>e.offsetHeight?i.viewport.height+2*r+"px":e.offsetHeight,t.style.width=i.viewport.width+"px",t.style.height=i.viewport.height+"px",t.className="viewport","circle"===i.viewport.type&&(t.className="viewport circle"),i.viewport.border.enable){var o=(e.offsetWidth-i.viewport.width)/2;i.viewport.border.width=o<i.viewport.border.width?o:i.viewport.border.width}else i.viewport.border.width=0;this.properties.viewport.style.borderWidth=i.viewport.border.width+"px",this.properties.viewport.style.borderColor=i.viewport.border.color,this.properties.container.appendChild(t)}function g(){var t=this.properties.image.style.transformOrigin.split("px ");return{x:parseFloat(t[0]),y:parseFloat(t[1])}}function v(){var t=g.call(this),e=t.x,i=t.y,r=-parseInt(this.properties.deg)*Math.PI/180;if("viewport"===this.options.transformOrigin){var o=this.properties.deg;this.properties.deg=0,this.properties.image.style.transform=y.call(this);var s,p,n=this.properties.scale,a=this.properties.container,h=this.properties.image.getBoundingClientRect(),l=this.properties.viewport.getBoundingClientRect(),c=l.top-h.top+l.height/2,d=(l.left-h.left+l.width/2)/n-e,m=c/n-i;s=e+(d*Math.cos(r)-m*Math.sin(r)),p=i+(d*Math.sin(r)+m*Math.cos(r)),this.properties.x=a.offsetWidth/2-s,this.properties.y=a.offsetHeight/2-p,this.properties.image.style.transformOrigin=f.call(this,s,p),this.properties.deg=o,this.properties.image.style.transform=y.call(this)}else this.properties.x-=this.properties.origin_x-e,this.properties.y-=this.properties.origin_y-i,this.properties.image.style.transformOrigin=f.call(this,this.properties.origin_x,this.properties.origin_y),this.properties.image.style.transform=y.call(this)}function s(){m.call(this),c.call(this),d.call(this),function(){this.properties.image||(this.properties.image=new Image),this.properties.image.ondragstart=function(){return!1},this.properties.container.appendChild(this.properties.image)}.call(this),u.call(this);var a,h,r=0,o=0,l=this,t=function(t){t.preventDefault();var e=t.pageX,i=t.pageY;t.touches&&(e=t.touches[0].pageX,i=t.touches[0].pageY),r=l.properties.x||r,o=l.properties.y||o,a=e-r,h=i-o,document.addEventListener("mousemove",s),document.addEventListener("touchmove",s),document.addEventListener("mouseup",p),document.addEventListener("touchend",p)};l.properties.image.addEventListener("mousedown",t),l.properties.image.addEventListener("touchstart",t);var s=function(t){t.preventDefault();var e=t.pageX,i=t.pageY;if(t.touches&&(e=t.touches[0].pageX,i=t.touches[0].pageY),t.touches&&1<t.touches.length){var r=t.touches[1],o=e-r.pageX,s=i-r.pageY;if(l.options.rotation.enable){var p=90-180*Math.atan2(o,s)/Math.PI;l.properties.odeg||(l.properties.odeg=p-l.properties.deg),l.properties.deg=p-l.properties.odeg}if(l.options.zoom.enable){var n=Math.sqrt(Math.pow(o,2)+Math.pow(s,2));l.properties.od||(l.properties.od=n/l.properties.scale),l.properties.scale=l.properties.slider.value=n/l.properties.od}}else l.properties.x=e-a,l.properties.y=i-h;l.properties.image.style.transform=y.call(l)},p=function t(){document.removeEventListener("touchmove",s),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",t),document.removeEventListener("touchend",t),l.properties.od=0,l.properties.odeg=0,v.call(l)};l.properties.container.addEventListener("mousewheel",function(t){t.preventDefault();var e=l.properties.scale+t.wheelDelta/1200*l.properties.scale;e>l.options.zoom.min&&e<l.options.zoom.max&&l.options.zoom.mouseWheel&&l.options.zoom.enable&&(l.options.zoom.slider&&(l.properties.slider.value=e),l.properties.scale=e,l.properties.image.style.transform=y.call(l))})}window.jQuery&&(jQuery.fn.cropme=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0;if("object"===w(e))return this.each(function(){var t=new r(this,e);$(this).data("cropme",t)});if("string"!=typeof e)throw"Error: the argument must be an object or a string";var i=$(this).data("cropme");switch(e){case"position":return i.position();case"bind":return i.bind(t);case"crop":return i.crop(t);case"rotate":return i.rotate(t);case"reload":return i.reload(t);case"destroy":return i.destroy();default:throw"Error: "+e+" method not found"}});var r=function(){function i(t,e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),-1<t.className.indexOf("cropme-wrapper"))throw"Error: Cropme is already initialized";if(this.properties={},this.options=h(p,e),this.options.viewport.width>this.options.container.width)throw"Error: Viewport width cannot be greater that container width";if(this.options.viewport.height>this.options.container.height)throw"Error: Viewport height cannot be greater that container height";"img"===(this.properties.wrapper=t).tagName.toLowerCase()&&(this.properties.image=new Image,this.properties.image.src=t.src,this.properties.wrapper=document.createElement("div"),t.parentNode.insertBefore(this.properties.wrapper,t.previousSibling),t.parentNode.removeChild(t)),this.properties.wrapper.className+=" cropme-wrapper "+this.options.customClass,s.call(this),this.properties.image.src&&this.bind({url:this.properties.image.src})}var t,e,r;return t=i,(e=[{key:"resize",value:function(){var t=this.properties.container,e=this.properties.container_w-t.offsetWidth,i=this.properties.container_h-t.offsetHeight;t.style.width=this.options.container.width+("string"==typeof this.options.container.width?"":"px"),t.offsetWidth>this.options.viewport.width?(this.properties.x-=e/2,this.properties.y-=i/2,this.properties.container_w=t.offsetWidth,this.properties.container_h=t.offsetHeight,this.properties.ox-=e/2,this.properties.oy-=i/2,this.properties.image.style.transform=y.call(this),d.call(this),c.call(this)):t.style.width=this.options.viewport.width+2*this.options.viewport.border.width+"px"}},{key:"bind",value:function(a){var t=this;window.onresize=this.resize.bind(this),this.properties.image.src=a.url;var h=this.properties,l=this.options,c=this;return new Promise(function(n){t.properties.image.onload=function(){var t=h.image.getBoundingClientRect(),e=h.container.getBoundingClientRect(),i=(e.width-t.width)/2,r=(e.height-t.height)/2,o=e.height/t.height,s=0;h.ox=i,h.oy=r;var p={};if("object"===w(a.position)&&(i=a.position.x?a.position.x+i:i,r=a.position.y?a.position.y+r:r,o=a.position.scale||o,s=a.position.angle||s,p=a.position.origin||p,l.transformOrigin="object"===a.position.origin?"viewport":"image"),l.zoom.max<=l.zoom.min)throw"Error: max zoom cannot be less or equal to min zoom";o<l.zoom.min&&(o=l.zoom.min),o>l.zoom.max&&(o=l.zoom.max),h.x=i,h.y=r,h.container_w=e.width,h.container_h=e.height,h.origin_x=t.width/2,h.origin_y=t.height/2,h.scale=o,c.options.zoom.slider&&(h.slider.value=o),c.options.rotation.slider&&(h.rotation_slider.value=s),h.deg=s,h.image.style.transform=y.call(c),h.image.style.transformOrigin=f.call(c,p.x||h.origin_x,p.y||h.origin_y),h.image.style.opacity=1,v.call(c),n(c.properties.image)}})}},{key:"rotate",value:function(t){this.properties.deg=t;var e=this.properties.image.style.transformOrigin.split("px "),i=parseInt(e[0]),r=parseInt(e[1]);this.properties.rotate_originx=i,this.properties.rotate_originy=r,this.properties.image.style.transform=y.call(this)}},{key:"crop",value:function(t){var i=function(t){var e=document.createElement("canvas"),i=e.getContext("2d"),r=this.options.viewport.width,o=this.options.viewport.height;"object"===w(t)&&(t.scale?(r*=t.scale,o*=t.scale):t.width&&(o=t.width*o/r,r=t.width)),e.width=r,e.height=o;var s=r/this.options.viewport.width,p=o/this.options.viewport.height,n=this.properties.deg,a=this.properties.x,h=this.properties.y;function l(t,e,i){this.properties.deg=t,this.properties.x=e,this.properties.y=i,this.properties.image.style.transform=y.call(this)}l.call(this,0,this.properties.ox,this.properties.oy);var c=this.properties.image.getBoundingClientRect(),d=this.properties.viewport.getBoundingClientRect(),m=s*(c.x-d.x-this.options.viewport.border.width),f=p*(c.y-d.y-this.options.viewport.border.width),u=this.options.transformOrigin,g=(a-this.properties.x)*s,v=(h-this.properties.y)*p;return"image"===u&&i.translate(g,v),i.translate(r/2,o/2),i.rotate(n*Math.PI/180),"image"===u?i.translate(-r/2,-o/2):i.translate(-r/2+g,-o/2+v),i.drawImage(this.properties.image,m,f,c.width*s,c.height*p),"circle"===this.options.viewport.type&&("image"===u?i.translate(r/2,o/2):i.translate(r/2-g,o/2-v),i.rotate(-n*Math.PI/180),i.translate(-r/2,-o/2),i.scale(1,this.options.viewport.height/this.options.viewport.width),"image"===u?i.translate(2*-g,2*-v):i.translate(-g,-v),i.globalCompositeOperation="destination-in",i.arc(r/2+g,o/2+v,r/2,0,2*Math.PI),i.fill()),l.call(this,n,a,h),e}.call(this,t);return t="object"===w(t)?t.type:t,new Promise(function(e){"blob"===t?i.toBlob(function(t){return e(URL.createObjectURL(t))}):e(i.toDataURL())})}},{key:"position",value:function(){var t={x:parseFloat((this.properties.x-this.properties.ox).toFixed(3)),y:parseFloat((this.properties.y-this.properties.oy).toFixed(3)),scale:parseFloat(this.properties.scale.toFixed(4)),angle:parseInt(this.properties.deg)};return"viewport"===this.options.transformOrigin&&(t.origin=g.call(this)),t}},{key:"reload",value:function(t){this.options=h(p,t),d.call(this),m.call(this),c.call(this),u.call(this),v.call(this)}},{key:"destroy",value:function(){this.properties.wrapper.innerHTML="",this.properties.wrapper.className=this.properties.wrapper.className.replace("cropme-wrapper",""),delete this.options,delete this.properties}}])&&o(t.prototype,e),r&&o(t,r),i}(),p={container:{width:300,height:300},viewport:{width:100,height:100,border:{enable:!0,width:2,color:"#fff"}},transformOrigin:"viewport",zoom:{min:.01,max:3,enable:!0,mouseWheel:!0,slider:!1},customClass:"",rotation:{slider:!1,enable:!0,position:"right"}};return r});